<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tasky</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd"
      crossorigin="anonymous"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
      rel="stylesheet"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
      }
      .container {
        display: flex;
        height: 100vh;
        overflow: hidden; /* Prevents double scrollbar */
      }
      .sidebar {
        position: fixed;
        width: 20%;
        height: 100%;
        background-color: #f8f9fa;
        overflow-y: hidden; /* Enables sidebar scrolling */
      }
      .main-page {
        margin-left: 20%;
        width: 80%;
        overflow-y: auto; /* Enables main page scrolling */
        padding: 20px;
        height: 100vh; /* Adjusts main page height to fill viewport */
      }
      .status {
        text-transform: capitalize;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar flex flex-col bg-gray-200 justify-between">
        <div class="main_content">
          <div class="header flex-row p-4">
            <span class="text-blue-700 text-5xl">Tasky</span>
          </div>
          <div class="body flex-col my-2 ml-2 pt-5">
            <div class="item rounded-tl-md rounded-bl-md p-2 mb-2 bg-[#3838E6]">
              <i class="bi bi-house-fill text-white"></i>
              <span class="text-white">Dashboard</span>
            </div>
            <div class="item mb-3 px-2">
              <i class="bi bi-clipboard-check-fill text-gray-400"></i>
              <span class="text-gray-400">Tasks</span>
            </div>
            <div class="item mb-3 px-2">
              <i class="bi bi-calendar-event text-gray-400"></i>
              <span class="text-gray-400">Calendar</span>
            </div>
            <div class="item mb-3 px-2">
              <i class="bi bi-people text-gray-400"></i>
              <span class="text-gray-400">Members</span>
            </div>
            <div class="item mb-3 px-2">
              <i class="bi bi-clipboard-check-fill text-gray-400"></i>
              <span class="text-gray-400">Tasks</span>
            </div>
          </div>
        </div>
        <div
          class="pro mx-auto max-w-screen-xl rounded-md w-[80%] h-[15%] bg-blue-500 mt-5 md:mt-0 mb-5 md:mb-0"
        >
          <img
            class="object-cover w-10 h-15 relative top-[-25%] left-[40%]"
            src="https://img.freepik.com/free-psd/psd-3d-render-rocket-ioslated-background_1409-3704.jpg?w=740&t=st=1719740347~exp=1719740947~hmac=9d883d24572f2fc43548e0d28196e4ba55177f91be92b6bc9c2766045fa6c877"
          />
          <span
            class="text-white font-mono text-sm text-center relative bottom-0"
            >Upgrade to pro</span
          >
        </div>
      </div>
      <div class="main-page flex-1">
        <div
          class="header flex flex-col md:flex-row justify-between items-center mb-5"
        >
          <div class="search-header w-full md:w-1/2 mb-4 md:mb-0">
            <input
              style="font-family: FontAwesome"
              placeholder="&#xf002; search tasks"
              class="bg-gray-200 w-full p-2"
            />
          </div>
          <div class="profile-bar flex space-x-4">
            <i class="bi bi-chat-left-text-fill text-xl"></i>
            <i class="bi bi-bell-fill text-xl"></i>
            <i class="bi bi-person-circle text-xl"></i>
          </div>
        </div>
        <div
          class="actions flex flex-col md:flex-row justify-between items-center mt-5"
        >
          <div class="left flex flex-row">
            <div class="p-2 item border-2 rounded-md mr-2 mb-2 md:mb-0">
              <i class="bi bi-box-seam text-sm"></i>
              <span class="text-sm">Preview</span>
            </div>
            <div class="p-2 item border-2 rounded-md mr-2 mb-2 md:mb-0">
              <i class="bi bi-sort-alpha-up text-sm"></i>
              <span class="text-sm">Sort</span>
            </div>
            <div class="p-2 item border-2 rounded-md mr-2 mb-2 md:mb-0">
              <i class="bi bi-filter text-sm"></i>
              <span class="text-sm">Filter</span>
            </div>
          </div>
          <div
            class="right flex justify-center md:justify-end w-full md:w-auto"
          >
            <div class="tasks-authors justify-between items-center">
              <i class="bi bi-person-circle text-xl text-green-400"></i>
              <i
                class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
              ></i>
              <i
                class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
              ></i>
              <i
                class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
              ></i>
              <i
                class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
              ></i>
              <button class="inline bg-[#435DAF] text-white rounded-md p-1 text-sm" id="addTaskBtn"> <i
                class="bi bi-plus"
              ></i> Add Task</button>
            </div>
          </div>
        </div>
        <div class=""></div>
        <div class="tasks flex flex-col md:flex-row justify-between mt-5">

          <div class="inprogress flex flex-col w-[30%]">
            <div
              class="border-blue-700 rounded-md border-2 flex justify-between items-center p-2 "
            >
              <span class="">In Progress(2) </span>
              <i class="bi bi-three-dots-vertical text-right"></i>
            </div>
               <div class="task-content mb-9">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>


             <div class="task-content mb-9">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>

                         <div class="task-content mb-9">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="completed flex flex-col w-[30%]">
            <div
              class="border-blue-700 rounded-md border-2 flex justify-between items-center p-2 mb-5"
            >
              <span class="">Completed Task (4) </span>
              <i class="bi bi-three-dots-vertical text-right"></i>
            </div>
                    <div class="task-content mb-9">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>
             <div class="task-content mb-9">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="overdue flex flex-col w-[30%]">
            <div
              class="border-blue-700 rounded-md border-2 flex justify-between items-center p-2 mb-5"
            >
              <span class="">Over-Due (5)</span>
              <i class="bi bi-three-dots-vertical"></i>
            </div>
            <div class="task-content">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[#FEDEDE] rounded-md px-3 py-1 text-sm"
                  >High</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>6:00 PM</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >UX Design</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">User Flow</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                  Designing a dashboared involves of creating a visual interface
                  that...
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill"></i>
                    <i class="bi bi-pencil-fill"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Add/Edit Task Modal -->
<div id="taskModal" class="modal hidden fixed z-10 inset-0 overflow-y-auto">
  <div class="flex items-center justify-center min-h-screen">
    <div class="modal-content bg-white rounded-lg shadow-lg p-6 relative w-full max-w-lg">
      <button class="close-modal absolute top-3 right-3 cursor-pointer text-gray-500">&times;</button>
      <h2 class="text-lg font-bold mb-4" id="modalTitle">Add Task</h2>
      <form id="taskForm">
        <input type="hidden" id="taskId">
        <div class="mb-4">
          <label for="taskPriority" class="block text-gray-700 text-sm font-bold mb-2">Priority:</label>
          <select id="taskPriority" name='priority' class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="mb-4">
          <label for="taskTime" class="block text-gray-700 text-sm font-bold mb-2">Due Date:</label>
          <input type="datetime-local" id="taskTime" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>
        <div class="mb-4">
          <label for="taskType" class="block text-gray-700 text-sm font-bold mb-2">Type:</label>
          <input type="text" id="taskType" name="type" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>
         <div class="mb-4">
          <label for="taskTitle" class="block text-gray-700 text-sm font-bold mb-2">Title:</label>
          <input id="taskTitle" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="title"/>
        </div>
        <div class="mb-4">
          <label for="taskDescription" class="block text-gray-700 text-sm font-bold mb-2">Description:</label>
          <textarea id="taskDescription" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" name="description"></textarea>
        </div>
        <div class="flex justify-end">
          <button type="button" id="saveTask" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal hidden fixed z-10 inset-0 overflow-y-auto">
  <div class="flex items-center justify-center min-h-screen">
    <div class="modal-content bg-white rounded-lg shadow-lg p-6 relative w-full max-w-lg">
      <span class="close-modal absolute top-3 right-3 cursor-pointer text-gray-500">&times;</span>
      <h2 class="text-lg font-bold mb-4">Delete Task</h2>
      <p>Are you sure you want to delete this task?</p>
      <div class="flex justify-end mt-4">
        <button type="button" id="confirmDelete" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Delete</button>
        <button type="button" class="close-modal ml-2 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Cancel</button>
      </div>
    </div>
  </div>
</div>

        </div>
      </div>
    </div>
  </body>
 <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function checkAuth() {
            const accessToken = localStorage.getItem('access');
            const refreshToken = localStorage.getItem('refresh');

            if (!accessToken || !refreshToken) {
                window.location.href = '/login';
                return;
            }

            const csrftoken = getCookie('csrftoken');

            $.ajax({
                url: '/api/check-auth/',
                type: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'X-CSRFToken': csrftoken
                },
                success: function(response) {
                    if (!response.is_authenticated) {
                        window.location.href = '/login';
                    }
                },
                error: function(xhr, status, error) {
                    // Optionally handle refresh token logic here if necessary
                    // For example, you can try to refresh the access token using the refresh token
                    window.location.href = '/login';
                }
            });
        }

        $(document).ready(function() {
            checkAuth();
  // Function to enable dragging on .task-content elements
 // Function to enable dragging on .task-content elements
  function enableDragAndDrop() {
    $('.task-content').attr('draggable', true);

    // Add event listeners for drag events
    $('.task-content').on('dragstart', function(event) {
      event.originalEvent.dataTransfer.setData('text/plain', event.target.id);
      event.originalEvent.dataTransfer.effectAllowed = 'move';
      $(this).addClass('dragging');
    });

    $('.task-content').on('dragend', function() {
      $(this).removeClass('dragging');
    });

    // Handle dragover event on the drop target
    $('.incomplete, .completed, .todo').on('dragover', function(event) {
      event.preventDefault();
      event.originalEvent.dataTransfer.dropEffect = 'move';
      $(this).addClass('dragover');
    });

    $('.incomplete, .completed, .todo').on('dragleave', function() {
      $(this).removeClass('dragover');
    });

    // Handle drop event on the drop target
    $('.incomplete, .completed, .todo').on('drop', function(event) {
      event.preventDefault();
      $(this).removeClass('dragover');

      let data = event.originalEvent.dataTransfer.getData('text/plain');
      let draggedElement = $('#' + data);
      $(this).append(draggedElement);

      // Update the task status
      let newStatus = $(this).data('status');
      updateTaskStatus(data, newStatus);
    });
  }

  // Function to update the status of the task
  function updateTaskStatus(taskId, newStatus) {
    tasks = tasks.map(task => {
      if (task.id == taskId) {
        task.status = newStatus;
      }
      return task;
    });
    //update 
    renderTasks(); // Re-render the tasks to reflect the updated status
  }

  // Function to render tasks
  function renderTasks() {
    $('.task-content, .task-content-1').empty();
    tasks.forEach(task => {
      console.log(task);
      let taskHtml2=`<div class="task-content mb-2" id="task-${task.id}">
              <div class="task-header flex justify-between items-center">
                <span class="bg-[${getPriorityColor(task.priority)}] rounded-md px-3 py-1 text-sm"
                  >${task.priority}</span
                >
                <span
                  class="shadow-xl rounded-md px-3 py-1 text-purple-500 font-semibold text-sm"
                  ><i class="bi bi-clock pr-1"></i>${task.due_date}</span
                >
                <span
                  class="rounded-md px-3 py-1 bg-purple-200 text-purple-800 text-sm"
                  >${task.category}</span
                >
              </div>
              <div class="task-body rounded-md bg-gray-200 mt-3 px-1 py-2">
                <div class="card-title flex justify-between items-center pb-4">
                  <span class="font-bold">${task.title}</span>
                  <i class="bi bi-three-dots-vertical text-gray-400"></i>
                </div>
                <div class="card-body truncate text-sm text-gray-400 mb-2">
                 ${task.description}
                </div>
                <div
                  class="tasks-milestone border-gray-400 border rounded-md p-[1px] text-gray-400 inline mb-2"
                >
                  <i class="bi bi-list-task"></i>
                  <span class="">0/3</span>
                </div>
                <div
                  class="tasks-footer flex flex-row justify-between items-center mt-1"
                >
                  <div class="tasks-authors justify-between items-center">
                    <i class="bi bi-person-circle text-xl text-green-400"></i>
                    <i
                      class="bi bi-person-circle text-xl text-blue-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-red-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-purple-400 ml-[-15px]"
                    ></i>
                    <i
                      class="bi bi-person-circle text-xl text-gray-400 ml-[-15px]"
                    ></i>
                  </div>
                  <div class="task-actions text-blue-700">
                    <i class="bi bi-eye"></i>
                    <i class="bi bi-trash-fill delete-${`task.id`}"></i>
                    <i class="bi bi-pencil-fill edit-${`task.id`}"></i>
                  </div>
                </div>
              </div>
            </div>`
      if(task.status=='In Progress'){
        $(`.inprogress`).append(taskHtml2);
      }
      else if(task.status=='Completed'){
        $(`.completed`).append(taskHtml2);
      }
      else if(task.status=='Overdue'){
        $(`.overdue`).append(taskHtml2);
      }
      else{
        console.log("...")
      }
    });

    enableDragAndDrop(); // Enable drag and drop on the rendered tasks
  }

  // Function to get the priority color
  function getPriorityColor(priority) {
    switch(priority) {
      case 'high': return '#FEDEDE';
      case 'medium': return '#E8E8E8';
      case 'low': return '#B4F2B4';
      default: return '#E8E8E8';
    }
  }

  // Fetch tasks from the API
  function fetchTasks() {
    const accessToken = localStorage.getItem('access');
    const refreshToken = localStorage.getItem('refresh');
    const csrftoken = getCookie('csrftoken');
    $.ajax({
      url: '/api/tasks/', // Replace with your API endpoint
      method: 'GET',
       headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'X-CSRFToken': csrftoken
                },
      dataType: 'json',
      success: function(data) {
        tasks = data.results; // Assuming the API returns an array of tasks
        renderTasks(); // Render the tasks after fetching
      },
      error: function(xhr, status, error) {
        console.error('Error fetching tasks:', error);
      }
    });
  }

  // Initial setup
  let tasks = []; // Empty array to hold tasks

  // Fetch and render tasks on page load
  fetchTasks();

   // Function to show the add/edit modal
    function showModal(title, task = null) {
        $('#taskModal .modal-title').text(title);
        if (task) {
            $('#taskModal input[name="id"]').val(task.id);
            $('#taskModal input[name="title"]').val(task.title);
            $('#taskModal textarea[name="description"]').val(task.description);
            $('#taskModal input[name="due_date"]').val(task.due_date);
        } else {
            $('#taskModal input[name="id"]').val('');
            $('#taskModal input[name="title"]').val('');
            $('#taskModal textarea[name="description"]').val('');
            $('#taskModal input[name="due_date"]').val('');
        }
        $('#taskModal').show();
    }

    // Function to handle form submission
    function handleFormSubmit(event) {
        event.preventDefault();
        const accessToken = localStorage.getItem('access');
        const refreshToken = localStorage.getItem('refresh');
        const taskId = $('#taskModal input[name="id"]').val();
        const url = taskId ? `/api/tasks/${taskId}/` : '/api/tasks/';
        const method = taskId ? 'PUT' : 'POST';
        const taskData = {
            title: $('#taskModal input[name="title"]').val(),
            priority: $('#taskModal input[name="priority"]').val(),
            category: $('#taskModal input[name="type"]').val(),
            status: "In Progress",
            description: $('#taskModal textarea[name="description"]').val(),
            due_date: $('#taskModal input[name="due_date"]').val(),
        };

        $.ajax({
            url: url,
            method: method,
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Authorization': `Bearer ${accessToken}`,
            },
            contentType: 'application/json',
            data: JSON.stringify(taskData),
            success: function(response) {
                $('#taskModal').hide();
                // Refresh tasks
                renderTasks()
            },
            error: function(xhr) {
                console.error(xhr.responseText);
            }
        });
    }

    // Function to load tasks from the API
    // Function to delete a task
    function deleteTask(taskId) {
      const accessToken = localStorage.getItem('access');
      const refreshToken = localStorage.getItem('refresh');
      const csrftoken = getCookie('csrftoken');
        $.ajax({
            url: `/api/tasks/${taskId}/`,
            method: 'DELETE',
                 headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'X-CSRFToken': csrftoken
                },
            success: function(response) {
                // Refresh tasks
                renderTasks();
            },
            error: function(xhr) {
                console.error(xhr.responseText);
            }
        });
    }

    // Load tasks on page load

    // Add task button click
    $('#addTaskBtn').click(function() {
        showModal('Add Task');
    });

    $('.close-modal').click(function() {
      $('#taskModal').hide();
    })
    // Edit task button click
    $('#taskList').on('click', '.edit-task', function() {
        const taskId = $(this).closest('.task-item').data('id');
        $.ajax({
            url: `/api/tasks/${taskId}/`,
            method: 'GET',
            success: function(task) {
                showModal('Edit Task', task);
            },
            error: function(xhr) {
                console.error(xhr.responseText);
            }
        });
    });

    // Delete task button click
    $('#taskList').on('click', '.delete-task', function() {
        const taskId = $(this).closest('.task-item').data('id');
        if (confirm('Are you sure you want to delete this task?')) {
            deleteTask(taskId);
        }
    });

    // Form submission
    $('#taskForm').submit(handleFormSubmit);
    $('#saveTask').click(handleFormSubmit);
});
    </script>
</html>